<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>php bmp格式图片转换成jpg格式程序 | Dray&#39;s Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="&amp;lt;?php
/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
*/
//php教程将bmp格式图片转换成jpg格式程序
function imagebmp($img,$file=&amp;quot;&amp;quot;,$rle=0) {

    $colorcou">
<meta property="og:type" content="article">
<meta property="og:title" content="php bmp格式图片转换成jpg格式程序">
<meta property="og:url" content="http://idc.wf/2011/02/18/php-bmp-format-image-into-jpg-format-program/index.html">
<meta property="og:site_name" content="Dray's Home">
<meta property="og:description" content="&amp;lt;?php
/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
*/
//php教程将bmp格式图片转换成jpg格式程序
function imagebmp($img,$file=&amp;quot;&amp;quot;,$rle=0) {

    $colorcou">
<meta property="og:updated_time" content="2015-12-30T14:12:19.565Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="php bmp格式图片转换成jpg格式程序">
<meta name="twitter:description" content="&amp;lt;?php
/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
*/
//php教程将bmp格式图片转换成jpg格式程序
function imagebmp($img,$file=&amp;quot;&amp;quot;,$rle=0) {

    $colorcou">
  
    <link rel="alternative" href="/atom.xml" title="Dray&#39;s Home" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://s.gravatar.com/avatar/00ced3a6cdfd0398fabe0717147a6a32?s=200" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Dray</a></h1>
		</hgroup>

		
		<p class="header-subtitle">疯狂痴呆傻，美甘苦涩禅。</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>標籤</li>
						
						<li>友情链接</li>
						
						
						<li>關於</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/DrayChou/" title="github">github</a>
					        
								<a class="rss" target="_blank" href="http://feeds.feedburner.com/WesHome" title="rss">rss</a>
					        
								<a class="twitter" target="_blank" href="http://twitter.com/_0dc/" title="twitter">twitter</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/net/" style="font-size: 10px;">.net</a> <a href="/tags/80/" style="font-size: 10px;">80</a> <a href="/tags/Octopress/" style="font-size: 10px;">Octopress</a> <a href="/tags/PushBullet/" style="font-size: 10px;">PushBullet</a> <a href="/tags/Shadowsocks/" style="font-size: 10px;">Shadowsocks</a> <a href="/tags/VisualStudio/" style="font-size: 10px;">VisualStudio</a> <a href="/tags/api/" style="font-size: 10px;">api</a> <a href="/tags/app/" style="font-size: 10px;">app</a> <a href="/tags/archlinux/" style="font-size: 10px;">archlinux</a> <a href="/tags/bash/" style="font-size: 10px;">bash</a> <a href="/tags/bluehost/" style="font-size: 10px;">bluehost</a> <a href="/tags/bmp/" style="font-size: 10px;">bmp</a> <a href="/tags/bug/" style="font-size: 10px;">bug</a> <a href="/tags/buzz/" style="font-size: 10px;">buzz</a> <a href="/tags/centos/" style="font-size: 10px;">centos</a> <a href="/tags/chrome/" style="font-size: 12px;">chrome</a> <a href="/tags/completion/" style="font-size: 10px;">completion</a> <a href="/tags/cow/" style="font-size: 10px;">cow</a> <a href="/tags/css/" style="font-size: 10px;">css</a> <a href="/tags/diary/" style="font-size: 12px;">diary</a> <a href="/tags/dir/" style="font-size: 10px;">dir</a> <a href="/tags/disqus/" style="font-size: 10px;">disqus</a> <a href="/tags/domain/" style="font-size: 10px;">domain</a> <a href="/tags/download/" style="font-size: 10px;">download</a> <a href="/tags/facebook/" style="font-size: 12px;">facebook</a> <a href="/tags/file/" style="font-size: 10px;">file</a> <a href="/tags/file-exists/" style="font-size: 10px;">file_exists</a> <a href="/tags/float/" style="font-size: 10px;">float</a> <a href="/tags/fqrouter/" style="font-size: 10px;">fqrouter</a> <a href="/tags/free/" style="font-size: 10px;">free</a> <a href="/tags/fund/" style="font-size: 10px;">fund</a> <a href="/tags/gedit/" style="font-size: 10px;">gedit</a> <a href="/tags/gfw/" style="font-size: 12px;">gfw</a> <a href="/tags/gnome/" style="font-size: 10px;">gnome</a> <a href="/tags/god/" style="font-size: 10px;">god</a> <a href="/tags/golang/" style="font-size: 10px;">golang</a> <a href="/tags/googlereader/" style="font-size: 10px;">googlereader</a> <a href="/tags/grub/" style="font-size: 10px;">grub</a> <a href="/tags/history/" style="font-size: 10px;">history</a> <a href="/tags/hosts/" style="font-size: 10px;">hosts</a> <a href="/tags/html/" style="font-size: 10px;">html</a> <a href="/tags/https/" style="font-size: 10px;">https</a> <a href="/tags/ie/" style="font-size: 10px;">ie</a> <a href="/tags/ie6/" style="font-size: 10px;">ie6</a> <a href="/tags/it/" style="font-size: 10px;">it</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/jquery/" style="font-size: 12px;">jquery</a> <a href="/tags/js/" style="font-size: 18px;">js</a> <a href="/tags/kde/" style="font-size: 10px;">kde</a> <a href="/tags/lamp/" style="font-size: 10px;">lamp</a> <a href="/tags/laravel/" style="font-size: 10px;">laravel</a> <a href="/tags/linux/" style="font-size: 16px;">linux</a> <a href="/tags/litespeed/" style="font-size: 10px;">litespeed</a> <a href="/tags/log/" style="font-size: 10px;">log</a> <a href="/tags/mac/" style="font-size: 10px;">mac</a> <a href="/tags/mail/" style="font-size: 10px;">mail</a> <a href="/tags/mantis/" style="font-size: 10px;">mantis</a> <a href="/tags/math/" style="font-size: 10px;">math</a> <a href="/tags/mysql/" style="font-size: 14px;">mysql</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/nodejs/" style="font-size: 10px;">nodejs</a> <a href="/tags/notepad/" style="font-size: 10px;">notepad</a> <a href="/tags/oschina/" style="font-size: 10px;">oschina</a> <a href="/tags/password/" style="font-size: 10px;">password</a> <a href="/tags/php/" style="font-size: 14px;">php</a> <a href="/tags/pi/" style="font-size: 10px;">pi</a> <a href="/tags/ping/" style="font-size: 10px;">ping</a> <a href="/tags/proxy/" style="font-size: 12px;">proxy</a> <a href="/tags/ruby/" style="font-size: 12px;">ruby</a> <a href="/tags/seo/" style="font-size: 10px;">seo</a> <a href="/tags/seperator/" style="font-size: 10px;">seperator</a> <a href="/tags/shadowsocks/" style="font-size: 10px;">shadowsocks</a> <a href="/tags/smarty/" style="font-size: 16px;">smarty</a> <a href="/tags/soap/" style="font-size: 10px;">soap</a> <a href="/tags/sources/" style="font-size: 12px;">sources</a> <a href="/tags/sql/" style="font-size: 10px;">sql</a> <a href="/tags/ssh/" style="font-size: 14px;">ssh</a> <a href="/tags/ssl/" style="font-size: 10px;">ssl</a> <a href="/tags/sublimetext/" style="font-size: 10px;">sublimetext</a> <a href="/tags/supervisor/" style="font-size: 10px;">supervisor</a> <a href="/tags/svn/" style="font-size: 10px;">svn</a> <a href="/tags/tag/" style="font-size: 10px;">tag</a> <a href="/tags/taobao/" style="font-size: 10px;">taobao</a> <a href="/tags/twister/" style="font-size: 10px;">twister</a> <a href="/tags/twitter/" style="font-size: 18px;">twitter</a> <a href="/tags/unlink/" style="font-size: 10px;">unlink</a> <a href="/tags/upload/" style="font-size: 10px;">upload</a> <a href="/tags/vanilla/" style="font-size: 10px;">vanilla</a> <a href="/tags/vps/" style="font-size: 20px;">vps</a> <a href="/tags/week/" style="font-size: 10px;">week</a> <a href="/tags/weibo/" style="font-size: 10px;">weibo</a> <a href="/tags/wine/" style="font-size: 10px;">wine</a> <a href="/tags/wordpress/" style="font-size: 12px;">wordpress</a> <a href="/tags/wsdl/" style="font-size: 10px;">wsdl</a> <a href="/tags/xampp/" style="font-size: 10px;">xampp</a> <a href="/tags/xmarks/" style="font-size: 10px;">xmarks</a> <a href="/tags/xml/" style="font-size: 10px;">xml</a> <a href="/tags/zsh/" style="font-size: 10px;">zsh</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.fangshanzi.com/">方片子的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://locyoo.com/blog/">Locyoo Manor|部落格</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://fpnews.cn/">方片快报</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://hskb.me/">黄书快报</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">我是谁，我从哪里来，我到哪里去？我就是我，是颜色不一样的吃货…</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Dray</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="http://s.gravatar.com/avatar/00ced3a6cdfd0398fabe0717147a6a32?s=200" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">Dray</h1>
			</hgroup>
			
			<p class="header-subtitle">疯狂痴呆傻，美甘苦涩禅。</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/DrayChou/" title="github">github</a>
			        
						<a class="rss" target="_blank" href="http://feeds.feedburner.com/WesHome" title="rss">rss</a>
			        
						<a class="twitter" target="_blank" href="http://twitter.com/_0dc/" title="twitter">twitter</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap"><article id="post-php-bmp-format-image-into-jpg-format-program" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2011/02/18/php-bmp-format-image-into-jpg-format-program/" class="article-date">
  	<time datetime="2011-02-17T16:00:00.000Z" itemprop="datePublished">2011-02-18</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      php bmp格式图片转换成jpg格式程序
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bmp/">bmp</a></li></ul>
	</div>

        
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/web/">web</a>
	</div>


        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <div class="cnblogs_code">

<pre><code>&lt;?php
/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
*/
//php教程将bmp格式图片转换成jpg格式程序
function imagebmp($img,$file=&quot;&quot;,$rle=0) {

    $colorcount=imagecolorstotal($img);
    $transparent=imagecolortransparent($img);
    $istransparent=$transparent!=-1;

    if($istransparent) $colorcount--;
    if($colorcount==0) {
        $colorcount=0;
        $bitcount=24;
    };
    if(($colorcount&gt;0)and($colorcount&lt;=2)) {
        $colorcount=2;
        $bitcount=1;
    };
    if(($colorcount&gt;2)and($colorcount&lt;=16)) {
        $colorcount=16;
        $bitcount=4;
    };
    if(($colorcount&gt;16)and($colorcount&lt;=256)) {
        $colorcount=0;
        $bitcount=8;
    };

    $width=imagesx($img);
    $height=imagesy($img);
    $zbytek=(4-($width/(8/$bitcount))%4)%4;
    if($bitcount&lt;24) $palsize=pow(2,$bitcount)*4;
    $size=(floor($width/(8/$bitcount))+$zbytek)*$height+54;
    $size+=$palsize;
    $offset=54+$palsize;
    // bitmap file header
    $ret = &apos;bm&apos;;                        // header (2b)
    $ret .= int_to_dword($size);        // size of file (4b)
    $ret .= int_to_dword(0);        // reserved (4b)
    $ret .= int_to_dword($offset);        // byte location in the file which is first byte of image (4b)
    // bitmap info header
    $ret .= int_to_dword(40);        // size of bitmapinfoheader (4b)
    $ret .= int_to_dword($width);        // width of bitmap (4b)
    $ret .= int_to_dword($height);        // height of bitmap (4b)
    $ret .= int_to_word(1);        // biplanes = 1 (2b)
    $ret .= int_to_word($bitcount);        // bibitcount = {1 (mono) or 4 (16 clr ) or 8 (256 clr) or 24 (16 mil)} (2b)
    $ret .= int_to_dword($rle);        // rle compression (4b)
    $ret .= int_to_dword(0);        // width x height (4b)
    $ret .= int_to_dword(0);        // bixpelspermeter (4b)
    $ret .= int_to_dword(0);        // biypelspermeter (4b)
    $ret .= int_to_dword(0);        // number of palettes used (4b)
    $ret .= int_to_dword(0);        // number of important colour (4b)
    // image data
    $cc=$colorcount;
    $sl1=strlen($ret);
    if($cc==0) $cc=256;
    if($bitcount&lt;24) {
        $colortotal=imagecolorstotal($img);
        if($istransparent) $colortotal--;
        for($p=0;$p&lt;$colortotal;$p++) {
            $color=imagecolorsforindex($img,$p);
            $ret.=inttobyte($color[&quot;blue&quot;]);
            $ret.=inttobyte($color[&quot;green&quot;]);
            $ret.=inttobyte($color[&quot;red&quot;]);
            $ret.=inttobyte(0); //reserved
        };
        $ct=$colortotal;
        for($p=$colortotal;$p&lt;$cc;$p++) {
            $ret.=inttobyte(0);
            $ret.=inttobyte(0);
            $ret.=inttobyte(0);
            $ret.=inttobyte(0); //reserved
        };
    };

    if($bitcount&lt;=8) {
        for($y=$height-1;$y&gt;=0;$y--) {
            $bwrite=&quot;&quot;;
            for($x=0;$x&lt;$width;$x++) {
                $color=imagecolorat($img,$x,$y);
                $bwrite.=decbinx($color,$bitcount);
                if(strlen($bwrite)==8) {
                    $retd.=inttobyte(bindec($bwrite));
                    $bwrite=&quot;&quot;;
                };
            };
            if((strlen($bwrite)&lt;8)and(strlen($bwrite)!=0)) {
                $sl=strlen($bwrite);
                for($t=0;$t&lt;8-$sl;$t++)
                    $sl.=&quot;0&quot;;
                $retd.=inttobyte(bindec($bwrite));
            };
            for($z=0;$z&lt;$zbytek;$z++)
                $retd.=inttobyte(0);
        };
    };
    if(($rle==1)and($bitcount==8)) {
        for($t=0;$t&lt;strlen($retd);$t+=4) {
            if($t!=0)
                if(($t)%$width==0)
                    $ret.=chr(0).chr(0);
            if(($t+5)%$width==0) {
                $ret.=chr(0).chr(5).substr($retd,$t,5).chr(0);
                $t+=1;
            }
            if(($t+6)%$width==0) {
                $ret.=chr(0).chr(6).substr($retd,$t,6);
                $t+=2;
            }
            else {
                $ret.=chr(0).chr(4).substr($retd,$t,4);
            };
        };
        $ret.=chr(0).chr(1);
    }
    else {
        $ret.=$retd;
    };

    if($bitcount==24) {
        for($z=0;$z&lt;$zbytek;$z++)
            $dopl.=chr(0);
        for($y=$height-1;$y&gt;=0;$y--) {
            for($x=0;$x&lt;$width;$x++) {
                $color=imagecolorsforindex($img,imagecolorat($img,$x,$y));
                $ret.=chr($color[&quot;blue&quot;]).chr($color[&quot;green&quot;]).chr($color[&quot;red&quot;]);
            }
            $ret.=$dopl;
        };
    };
    if($file!=&quot;&quot;) {
        $r=($f=fopen($file,&quot;w&quot;));
        $r=$r and fwrite($f,$ret);
        $r=$r and fclose($f);
        return $r;
    }
    else {
        echo $ret;
    };
};

/*
*------------------------------------------------------------
*                    imagecreatefrombmp
*------------------------------------------------------------
*            - reads image from a bmp file
*
*         parameters:  $file - target file to load
*
*            returns: image id
*/
function imagecreatefrombmp($file) {
    global  $currentbit, $echomode;
    $f=fopen($file,&quot;r&quot;);
    $header=fread($f,2);
    if($header==&quot;bm&quot;) {
        $size=freaddword($f);
        $reserved1=freadword($f);
        $reserved2=freadword($f);
        $firstbyteofimage=freaddword($f);
        $sizebitmapinfoheader=freaddword($f);
        $width=freaddword($f);
        $height=freaddword($f);
        $biplanes=freadword($f);
        $bibitcount=freadword($f);
        $rlecompression=freaddword($f);
        $widthxheight=freaddword($f);
        $bixpelspermeter=freaddword($f);
        $biypelspermeter=freaddword($f);
        $numberofpalettesused=freaddword($f);
        $numberofimportantcolors=freaddword($f);
        if($bibitcount&lt;24) {
            $img=imagecreate($width,$height);
            $colors=pow(2,$bibitcount);
            for($p=0;$p&lt;$colors;$p++) {
                $b=freadbyte($f);
                $g=freadbyte($f);
                $r=freadbyte($f);
                $reserved=freadbyte($f);
                $palette[]=imagecolorallocate($img,$r,$g,$b);
            };

            if($rlecompression==0) {
                $zbytek=(4-ceil(($width/(8/$bibitcount)))%4)%4;
                for($y=$height-1;$y&gt;=0;$y--) {
                    $currentbit=0;
                    for($x=0;$x&lt;$width;$x++) {
                        $c=freadbits($f,$bibitcount);
                        imagesetpixel($img,$x,$y,$palette[$c]);
                    };
                    if($currentbit!=0) {
                        freadbyte($f);
                    };
                    for($g=0;$g&lt;$zbytek;$g++)
                        freadbyte($f);
                };
            };
        };

        if($rlecompression==1) //$bi_rle8
        {
            $y=$height;
            $pocetb=0;
            while(true) {
                $y--;
                $prefix=freadbyte($f);
                $suffix=freadbyte($f);
                $pocetb+=2;
                $echoit=false;
                if($echoit)echo &quot;prefix: $prefix suffix: $suffix&lt;br&gt;&quot;;
                if(($prefix==0)and($suffix==1)) break;
                if(feof($f)) break;
                while(!(($prefix==0)and($suffix==0))) {
                    if($prefix==0) {
                        $pocet=$suffix;
                        $data.=fread($f,$pocet);
                        $pocetb+=$pocet;
                        if($pocetb%2==1) {
                            freadbyte($f);
                            $pocetb++;
                        };
                    };
                    if($prefix&gt;0) {
                        $pocet=$prefix;
                        for($r=0;$r&lt;$pocet;$r++)
                            $data.=chr($suffix);
                    };
                    $prefix=freadbyte($f);
                    $suffix=freadbyte($f);
                    $pocetb+=2;
                    if($echoit) echo &quot;prefix: $prefix suffix: $suffix&lt;br&gt;&quot;;
                };
                for($x=0;$x&lt;strlen($data);$x++) {
                    imagesetpixel($img,$x,$y,$palette[ord($data[$x])]);
                };
                $data=&quot;&quot;;
            };
        };

        if($rlecompression==2) //$bi_rle4
        {
            $y=$height;
            $pocetb=0;
            /*while(!feof($f))
 echo freadbyte($f).&quot;_&quot;.freadbyte($f).&quot;&lt;br&gt;&quot;;*/
            while(true) {
//break;
                $y--;
                $prefix=freadbyte($f);
                $suffix=freadbyte($f);
                $pocetb+=2;
                $echoit=false;
                if($echoit)echo &quot;prefix: $prefix suffix: $suffix&lt;br&gt;&quot;;
                if(($prefix==0)and($suffix==1)) break;
                if(feof($f)) break;
                while(!(($prefix==0)and($suffix==0))) {
                    if($prefix==0) {
                        $pocet=$suffix;
                        $currentbit=0;
                        for($h=0;$h&lt;$pocet;$h++)
                            $data.=chr(freadbits($f,4));
                        if($currentbit!=0) freadbits($f,4);
                        $pocetb+=ceil(($pocet/2));
                        if($pocetb%2==1) {
                            freadbyte($f);
                            $pocetb++;
                        };
                    };
                    if($prefix&gt;0) {
                        $pocet=$prefix;
                        $i=0;
                        for($r=0;$r&lt;$pocet;$r++) {
                            if($i%2==0) {
                                $data.=chr($suffix%16);
                            }
                            else {
                                $data.=chr(floor($suffix/16));
                            };
                            $i++;
                        };
                    };
                    $prefix=freadbyte($f);
                    $suffix=freadbyte($f);
                    $pocetb+=2;
                    if($echoit) echo &quot;prefix: $prefix suffix: $suffix&lt;br&gt;&quot;;
                };
                for($x=0;$x&lt;strlen($data);$x++) {
                    imagesetpixel($img,$x,$y,$palette[ord($data[$x])]);
                };
                $data=&quot;&quot;;
            };
        };

        if($bibitcount==24) {
            $img=imagecreatetruecolor($width,$height);
            $zbytek=$width%4;
            for($y=$height-1;$y&gt;=0;$y--) {
                for($x=0;$x&lt;$width;$x++) {
                    $b=freadbyte($f);
                    $g=freadbyte($f);
                    $r=freadbyte($f);
                    $color=imagecolorexact($img,$r,$g,$b);
                    if($color==-1) $color=imagecolorallocate($img,$r,$g,$b);
                    imagesetpixel($img,$x,$y,$color);
                }
                for($z=0;$z&lt;$zbytek;$z++)
                    freadbyte($f);
            };
        };
        return $img;
    };

    fclose($f);

};

/*
* helping functions:
*-------------------------
*
* freadbyte($file) - reads 1 byte from $file
* freadword($file) - reads 2 bytes (1 word) from $file
* freaddword($file) - reads 4 bytes (1 dword) from $file
* freadlngint($file) - same as freaddword($file)
* decbin8($d) - returns binary string of d zero filled to 8
* retbits($byte,$start,$len) - returns bits $start-&gt;$start+$len from $byte
* freadbits($file,$count) - reads next $count bits from $file
* rgbtohex($r,$g,$b) - convert $r, $g, $b to hex
* int_to_dword($n) - returns 4 byte representation of $n
* int_to_word($n) - returns 2 byte representation of $n
*/
function freadbyte($f) {
    return ord(fread($f,1));
};
function freadword($f) {
    $b1=freadbyte($f);
    $b2=freadbyte($f);
    return $b2*256+$b1;
};

function freadlngint($f) {
    return freaddword($f);
};
function freaddword($f) {
    $b1=freadword($f);
    $b2=freadword($f);
    return $b2*65536+$b1;
};

function retbits($byte,$start,$len) {
    $bin=decbin8($byte);
    $r=bindec(substr($bin,$start,$len));
    return $r;
};

$currentbit=0;
function freadbits($f,$count) {
    global $currentbit,$smode;
    $byte=freadbyte($f);
    $lastcbit=$currentbit;
    $currentbit+=$count;
    if($currentbit==8) {
        $currentbit=0;
    }
    else {
        fseek($f,ftell($f)-1);
    };
    return retbits($byte,$lastcbit,$count);
};

function rgbtohex($red,$green,$blue) {
    $hred=dechex($red);
    if(strlen($hred)==1) $hred=&quot;0$hred&quot;;
    $hgreen=dechex($green);
    if(strlen($hgreen)==1) $hgreen=&quot;0$hgreen&quot;;
    $hblue=dechex($blue);
    if(strlen($hblue)==1) $hblue=&quot;0$hblue&quot;;
    return($hred.$hgreen.$hblue);
};
function int_to_dword($n) {
    return chr($n &amp; 255).chr(($n &gt;&gt; 8) &amp; 255).chr(($n &gt;&gt; 16) &amp; 255).chr(($n &gt;&gt; 24) &amp; 255);
}
function int_to_word($n) {
    return chr($n &amp; 255).chr(($n &gt;&gt; 8) &amp; 255);
}

function decbin8($d) {
    return decbinx($d,8);
};
function decbinx($d,$n) {
    $bin=decbin($d);
    $sbin=strlen($bin);
    for($j=0;$j&lt;$n-$sbin;$j++)
        $bin=&quot;0$bin&quot;;
    return $bin;
};
function inttobyte($n) {
    return chr($n);
};

//实例方法
//include_once(&apos;bmp.php&apos;);
$image=imagecreatefrombmp(&apos;a.bmp&apos;);
imagejpeg($image,&apos;a.jpeg&apos;);
imagedestroy($image);
</code></pre></div>
      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2011/02/18/fund-22-asked-you-know-it/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          公积金22问，你懂它吗？
        
      </div>
    </a>
  
  
    <a href="/2011/02/18/jquery-live-and-event-delegation/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">jQuery.live()与Event Delegation</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share_jia">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到: &nbsp; </span>
		<a class="jiathis_button_facebook"></a> 
    <a class="jiathis_button_twitter"></a>
    <a class="jiathis_button_plus"></a> 
    <a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>








</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2015 Dray
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>